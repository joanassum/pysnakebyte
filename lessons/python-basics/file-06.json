{
  "id": "file-06",
  "title": "Working with CSV",
  "category": "File Handling",
  "number": 78,
  "duration": "8 min read",
  "content": "## Working with CSV Files\n\nCSV (Comma-Separated Values) is a common format for storing tabular data. Python's built-in `csv` module provides robust tools for reading and writing CSV files.\n\n## Reading CSV Files\n\n### Basic Reading with csv.reader\n\n```python\nimport csv\n\nwith open('data.csv', 'r') as file:\n    reader = csv.reader(file)\n    \n    for row in reader:\n        print(row)  # Each row is a list\n```\n\n### Reading with Headers\n\n```python\nimport csv\n\nwith open('data.csv', 'r') as file:\n    reader = csv.reader(file)\n    \n    # Get header row\n    headers = next(reader)\n    print(f'Columns: {headers}')\n    \n    # Process data rows\n    for row in reader:\n        print(row)\n```\n\n### Reading as Dictionaries\n\n```python\nimport csv\n\nwith open('data.csv', 'r') as file:\n    reader = csv.DictReader(file)\n    \n    for row in reader:\n        # Each row is an OrderedDict\n        print(row['name'], row['age'])\n```\n\n## Writing CSV Files\n\n### Basic Writing with csv.writer\n\n```python\nimport csv\n\ndata = [\n    ['Name', 'Age', 'City'],\n    ['Alice', 30, 'New York'],\n    ['Bob', 25, 'Los Angeles'],\n    ['Charlie', 35, 'Chicago']\n]\n\nwith open('output.csv', 'w', newline='') as file:\n    writer = csv.writer(file)\n    \n    for row in data:\n        writer.writerow(row)\n```\n\n### Writing Multiple Rows at Once\n\n```python\nimport csv\n\ndata = [\n    ['Alice', 30, 'New York'],\n    ['Bob', 25, 'Los Angeles'],\n    ['Charlie', 35, 'Chicago']\n]\n\nwith open('output.csv', 'w', newline='') as file:\n    writer = csv.writer(file)\n    writer.writerow(['Name', 'Age', 'City'])  # Header\n    writer.writerows(data)  # All data rows\n```\n\n### Writing Dictionaries\n\n```python\nimport csv\n\ndata = [\n    {'name': 'Alice', 'age': 30, 'city': 'New York'},\n    {'name': 'Bob', 'age': 25, 'city': 'Los Angeles'},\n    {'name': 'Charlie', 'age': 35, 'city': 'Chicago'}\n]\n\nwith open('output.csv', 'w', newline='') as file:\n    fieldnames = ['name', 'age', 'city']\n    writer = csv.DictWriter(file, fieldnames=fieldnames)\n    \n    writer.writeheader()  # Write header row\n    writer.writerows(data)  # Write all data\n```\n\n## CSV Dialects and Formatting\n\n### Custom Delimiters\n\n```python\nimport csv\n\n# Reading tab-separated values\nwith open('data.tsv', 'r') as file:\n    reader = csv.reader(file, delimiter='\\t')\n    for row in reader:\n        print(row)\n\n# Writing with semicolon separator\nwith open('data.csv', 'w', newline='') as file:\n    writer = csv.writer(file, delimiter=';')\n    writer.writerow(['a', 'b', 'c'])\n```\n\n### Handling Quotes\n\n```python\nimport csv\n\n# Quote all fields\nwith open('quoted.csv', 'w', newline='') as file:\n    writer = csv.writer(file, quoting=csv.QUOTE_ALL)\n    writer.writerow(['Name', 'Comment'])\n    writer.writerow(['Alice', 'Said \"Hello\"'])\n\n# Quoting options:\n# csv.QUOTE_ALL - Quote all fields\n# csv.QUOTE_MINIMAL - Quote only when needed (default)\n# csv.QUOTE_NONNUMERIC - Quote non-numeric fields\n# csv.QUOTE_NONE - Never quote (escape instead)\n```\n\n## Practical Examples\n\n### Processing Sales Data\n\n```python\nimport csv\n\ntotal_sales = 0\nproduct_sales = {}\n\nwith open('sales.csv', 'r') as file:\n    reader = csv.DictReader(file)\n    \n    for row in reader:\n        product = row['product']\n        amount = float(row['amount'])\n        \n        total_sales += amount\n        product_sales[product] = product_sales.get(product, 0) + amount\n\nprint(f'Total Sales: ${total_sales:,.2f}')\nfor product, sales in product_sales.items():\n    print(f'{product}: ${sales:,.2f}')\n```\n\n### Filtering and Transforming CSV\n\n```python\nimport csv\n\nwith open('input.csv', 'r') as infile, open('output.csv', 'w', newline='') as outfile:\n    reader = csv.DictReader(infile)\n    \n    fieldnames = ['name', 'email', 'status']\n    writer = csv.DictWriter(outfile, fieldnames=fieldnames)\n    writer.writeheader()\n    \n    for row in reader:\n        if row['active'] == 'true':\n            writer.writerow({\n                'name': row['name'].title(),\n                'email': row['email'].lower(),\n                'status': 'Active'\n            })\n```\n\n### Merging CSV Files\n\n```python\nimport csv\n\ndef merge_csv_files(file_list, output_file):\n    all_rows = []\n    headers = None\n    \n    for filename in file_list:\n        with open(filename, 'r') as f:\n            reader = csv.DictReader(f)\n            if headers is None:\n                headers = reader.fieldnames\n            all_rows.extend(list(reader))\n    \n    with open(output_file, 'w', newline='') as f:\n        writer = csv.DictWriter(f, fieldnames=headers)\n        writer.writeheader()\n        writer.writerows(all_rows)\n\nmerge_csv_files(['data1.csv', 'data2.csv'], 'merged.csv')\n```\n\n### CSV to List of Objects\n\n```python\nimport csv\nfrom dataclasses import dataclass\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n    email: str\n\ndef load_people(filename):\n    people = []\n    with open(filename, 'r') as f:\n        reader = csv.DictReader(f)\n        for row in reader:\n            person = Person(\n                name=row['name'],\n                age=int(row['age']),\n                email=row['email']\n            )\n            people.append(person)\n    return people\n\npeople = load_people('people.csv')\nfor person in people:\n    print(f'{person.name} is {person.age} years old')\n```\n\n## Handling Edge Cases\n\n```python\nimport csv\n\n# Handle missing values\nwith open('data.csv', 'r') as f:\n    reader = csv.DictReader(f)\n    for row in reader:\n        name = row.get('name', 'Unknown')\n        age = int(row['age']) if row['age'] else 0\n\n# Handle different encodings\nwith open('data.csv', 'r', encoding='utf-8-sig') as f:  # BOM handling\n    reader = csv.reader(f)\n    for row in reader:\n        print(row)\n\n# Skip blank lines\nwith open('data.csv', 'r') as f:\n    reader = csv.reader(f)\n    for row in reader:\n        if row:  # Skip empty rows\n            print(row)\n```",
  "code": "# Working with CSV Files\nimport csv\nimport os\n\n# Create sample CSV data\nprint(\"=== Creating Sample CSV ===\")\nwith open('employees.csv', 'w', newline='') as f:\n    writer = csv.writer(f)\n    writer.writerow(['name', 'department', 'salary', 'years'])\n    writer.writerows([\n        ['Alice Smith', 'Engineering', 85000, 5],\n        ['Bob Johnson', 'Marketing', 65000, 3],\n        ['Carol White', 'Engineering', 92000, 7],\n        ['David Brown', 'Sales', 55000, 2],\n        ['Eve Davis', 'Marketing', 72000, 4]\n    ])\nprint(\"Created employees.csv\")\n\n# Example 1: Basic reading with csv.reader\nprint(\"\\n=== Reading with csv.reader ===\")\nwith open('employees.csv', 'r') as f:\n    reader = csv.reader(f)\n    for row in reader:\n        print(row)\n\n# Example 2: Reading with DictReader\nprint(\"\\n=== Reading with DictReader ===\")\nwith open('employees.csv', 'r') as f:\n    reader = csv.DictReader(f)\n    for row in reader:\n        print(f\"{row['name']} works in {row['department']}\")\n\n# Example 3: Writing with DictWriter\nprint(\"\\n=== Writing with DictWriter ===\")\nproducts = [\n    {'id': 1, 'name': 'Laptop', 'price': 999.99},\n    {'id': 2, 'name': 'Mouse', 'price': 29.99},\n    {'id': 3, 'name': 'Keyboard', 'price': 79.99}\n]\n\nwith open('products.csv', 'w', newline='') as f:\n    writer = csv.DictWriter(f, fieldnames=['id', 'name', 'price'])\n    writer.writeheader()\n    writer.writerows(products)\n\nwith open('products.csv', 'r') as f:\n    print(f.read())\n\n# Example 4: Analyzing CSV data\nprint(\"=== Analyzing Employee Data ===\")\nwith open('employees.csv', 'r') as f:\n    reader = csv.DictReader(f)\n    employees = list(reader)\n\n# Calculate statistics\ntotal_salary = sum(int(e['salary']) for e in employees)\navg_salary = total_salary / len(employees)\nprint(f\"Total employees: {len(employees)}\")\nprint(f\"Total salary: ${total_salary:,}\")\nprint(f\"Average salary: ${avg_salary:,.2f}\")\n\n# Group by department\ndept_salaries = {}\nfor emp in employees:\n    dept = emp['department']\n    salary = int(emp['salary'])\n    if dept not in dept_salaries:\n        dept_salaries[dept] = []\n    dept_salaries[dept].append(salary)\n\nprint(\"\\nBy Department:\")\nfor dept, salaries in dept_salaries.items():\n    avg = sum(salaries) / len(salaries)\n    print(f\"  {dept}: {len(salaries)} employees, avg ${avg:,.2f}\")\n\n# Example 5: Filtering and creating new CSV\nprint(\"\\n=== Filtering High Earners ===\")\nwith open('employees.csv', 'r') as infile:\n    with open('high_earners.csv', 'w', newline='') as outfile:\n        reader = csv.DictReader(infile)\n        writer = csv.DictWriter(outfile, fieldnames=reader.fieldnames)\n        writer.writeheader()\n        \n        for row in reader:\n            if int(row['salary']) >= 70000:\n                writer.writerow(row)\n\nwith open('high_earners.csv', 'r') as f:\n    print(f.read())\n\n# Clean up\nfor fname in ['employees.csv', 'products.csv', 'high_earners.csv']:\n    os.remove(fname)\nprint(\"Cleaned up CSV files.\")"
}
