{
  "id": "file-07",
  "title": "Working with JSON",
  "category": "File Handling",
  "number": 79,
  "duration": "8 min read",
  "content": "## Working with JSON Files\n\nJSON (JavaScript Object Notation) is a lightweight data interchange format. Python's `json` module makes it easy to read, write, and manipulate JSON data.\n\n## Reading JSON Files\n\n### Basic Reading\n\n```python\nimport json\n\n# Read JSON file into Python object\nwith open('data.json', 'r') as file:\n    data = json.load(file)\n\nprint(data)  # Python dict or list\nprint(type(data))\n```\n\n### Parsing JSON Strings\n\n```python\nimport json\n\njson_string = '{\"name\": \"Alice\", \"age\": 30}'\n\n# Parse JSON string\ndata = json.loads(json_string)\nprint(data['name'])  # Alice\n```\n\n## Writing JSON Files\n\n### Basic Writing\n\n```python\nimport json\n\ndata = {\n    'name': 'Alice',\n    'age': 30,\n    'city': 'New York',\n    'hobbies': ['reading', 'hiking', 'coding']\n}\n\nwith open('output.json', 'w') as file:\n    json.dump(data, file)\n```\n\n### Pretty Printing\n\n```python\nimport json\n\ndata = {'name': 'Alice', 'scores': [85, 92, 78]}\n\n# Write with indentation\nwith open('output.json', 'w') as file:\n    json.dump(data, file, indent=2)\n\n# Result:\n# {\n#   \"name\": \"Alice\",\n#   \"scores\": [\n#     85,\n#     92,\n#     78\n#   ]\n# }\n```\n\n### Converting to JSON String\n\n```python\nimport json\n\ndata = {'name': 'Alice', 'age': 30}\n\n# Convert to JSON string\njson_string = json.dumps(data)\nprint(json_string)  # '{\"name\": \"Alice\", \"age\": 30}'\n\n# Pretty print string\npretty = json.dumps(data, indent=4)\nprint(pretty)\n```\n\n## JSON Data Types\n\n```python\nimport json\n\n# Python to JSON type mapping\ndata = {\n    'string': 'hello',           # str -> string\n    'integer': 42,                # int -> number\n    'float': 3.14,                # float -> number\n    'boolean': True,              # bool -> true/false\n    'null': None,                 # None -> null\n    'list': [1, 2, 3],            # list -> array\n    'dict': {'a': 1, 'b': 2}      # dict -> object\n}\n\njson_str = json.dumps(data, indent=2)\nprint(json_str)\n```\n\n## Advanced Options\n\n### Sorting Keys\n\n```python\nimport json\n\ndata = {'z': 1, 'a': 2, 'm': 3}\n\n# Sort keys alphabetically\njson_str = json.dumps(data, sort_keys=True)\nprint(json_str)  # '{\"a\": 2, \"m\": 3, \"z\": 1}'\n```\n\n### Handling Special Characters\n\n```python\nimport json\n\ndata = {'message': 'Hello, \\\"World\\\"!', 'emoji': '\\ud83d\\ude00'}\n\n# ensure_ascii=False preserves Unicode\njson_str = json.dumps(data, ensure_ascii=False)\nprint(json_str)\n```\n\n### Compact Output\n\n```python\nimport json\n\ndata = {'name': 'Alice', 'items': [1, 2, 3]}\n\n# Remove whitespace for compact output\ncompact = json.dumps(data, separators=(',', ':'))\nprint(compact)  # '{\"name\":\"Alice\",\"items\":[1,2,3]}'\n```\n\n## Handling Custom Objects\n\n### Custom Encoder\n\n```python\nimport json\nfrom datetime import datetime, date\n\nclass CustomEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, datetime):\n            return obj.isoformat()\n        if isinstance(obj, date):\n            return obj.isoformat()\n        return super().default(obj)\n\ndata = {\n    'event': 'Meeting',\n    'date': datetime.now()\n}\n\njson_str = json.dumps(data, cls=CustomEncoder, indent=2)\nprint(json_str)\n```\n\n### Custom Decoder\n\n```python\nimport json\nfrom datetime import datetime\n\ndef datetime_decoder(dct):\n    for key, value in dct.items():\n        if isinstance(value, str):\n            try:\n                dct[key] = datetime.fromisoformat(value)\n            except ValueError:\n                pass\n    return dct\n\njson_str = '{\"event\": \"Meeting\", \"date\": \"2024-01-15T14:30:00\"}'\ndata = json.loads(json_str, object_hook=datetime_decoder)\nprint(data['date'])  # datetime object\n```\n\n## Practical Examples\n\n### Configuration File\n\n```python\nimport json\n\ndef load_config(filename):\n    try:\n        with open(filename, 'r') as f:\n            return json.load(f)\n    except FileNotFoundError:\n        return {}  # Default empty config\n\ndef save_config(filename, config):\n    with open(filename, 'w') as f:\n        json.dump(config, f, indent=2)\n\n# Usage\nconfig = load_config('settings.json')\nconfig['theme'] = 'dark'\nconfig['font_size'] = 14\nsave_config('settings.json', config)\n```\n\n### API Response Handling\n\n```python\nimport json\n\n# Simulated API response\napi_response = '''\n{\n    \"status\": \"success\",\n    \"data\": {\n        \"users\": [\n            {\"id\": 1, \"name\": \"Alice\"},\n            {\"id\": 2, \"name\": \"Bob\"}\n        ]\n    }\n}\n'''\n\nresponse = json.loads(api_response)\n\nif response['status'] == 'success':\n    users = response['data']['users']\n    for user in users:\n        print(f\"User {user['id']}: {user['name']}\")\n```\n\n### Data Transformation\n\n```python\nimport json\n\n# Load, transform, save\nwith open('input.json', 'r') as f:\n    data = json.load(f)\n\n# Transform data\ntransformed = {\n    'total_items': len(data['items']),\n    'item_names': [item['name'] for item in data['items']],\n    'processed': True\n}\n\nwith open('output.json', 'w') as f:\n    json.dump(transformed, f, indent=2)\n```\n\n## Error Handling\n\n```python\nimport json\n\n# Handle invalid JSON\ntry:\n    data = json.loads('{invalid json}')\nexcept json.JSONDecodeError as e:\n    print(f'Invalid JSON: {e}')\n\n# Handle file errors\ntry:\n    with open('config.json', 'r') as f:\n        config = json.load(f)\nexcept FileNotFoundError:\n    config = {'default': True}\nexcept json.JSONDecodeError:\n    print('Config file is corrupted')\n    config = {'default': True}\n```",
  "code": "# Working with JSON Files\nimport json\nimport os\n\n# Example 1: Writing JSON\nprint(\"=== Writing JSON ===\")\nuser = {\n    'name': 'Alice Smith',\n    'age': 28,\n    'email': 'alice@example.com',\n    'active': True,\n    'roles': ['user', 'admin'],\n    'settings': {\n        'theme': 'dark',\n        'notifications': True\n    }\n}\n\nwith open('user.json', 'w') as f:\n    json.dump(user, f, indent=2)\n\nprint(\"Written user.json:\")\nwith open('user.json', 'r') as f:\n    print(f.read())\n\n# Example 2: Reading JSON\nprint(\"\\n=== Reading JSON ===\")\nwith open('user.json', 'r') as f:\n    loaded_user = json.load(f)\n\nprint(f\"Name: {loaded_user['name']}\")\nprint(f\"Email: {loaded_user['email']}\")\nprint(f\"Roles: {', '.join(loaded_user['roles'])}\")\nprint(f\"Theme: {loaded_user['settings']['theme']}\")\n\n# Example 3: JSON strings with loads/dumps\nprint(\"\\n=== JSON Strings ===\")\njson_string = '{\"product\": \"Laptop\", \"price\": 999.99, \"in_stock\": true}'\nproduct = json.loads(json_string)\nprint(f\"Product: {product['product']}\")\nprint(f\"Price: ${product['price']}\")\n\n# Convert back to string\nnew_json = json.dumps(product, indent=2)\nprint(f\"Back to JSON:\\n{new_json}\")\n\n# Example 4: Working with lists\nprint(\"\\n=== List of Objects ===\")\ntasks = [\n    {'id': 1, 'task': 'Learn Python', 'done': True},\n    {'id': 2, 'task': 'Build project', 'done': False},\n    {'id': 3, 'task': 'Deploy app', 'done': False}\n]\n\nwith open('tasks.json', 'w') as f:\n    json.dump(tasks, f, indent=2)\n\nwith open('tasks.json', 'r') as f:\n    loaded_tasks = json.load(f)\n\nprint(\"Tasks:\")\nfor task in loaded_tasks:\n    status = 'Done' if task['done'] else 'Pending'\n    print(f\"  [{status}] {task['task']}\")\n\n# Example 5: Modifying JSON data\nprint(\"\\n=== Modifying JSON ===\")\nwith open('tasks.json', 'r') as f:\n    tasks = json.load(f)\n\n# Mark task 2 as done\nfor task in tasks:\n    if task['id'] == 2:\n        task['done'] = True\n\n# Add new task\ntasks.append({'id': 4, 'task': 'Write tests', 'done': False})\n\nwith open('tasks.json', 'w') as f:\n    json.dump(tasks, f, indent=2)\n\nprint(\"Updated tasks:\")\nwith open('tasks.json', 'r') as f:\n    print(f.read())\n\n# Example 6: Custom objects with encoder\nprint(\"=== Custom Encoder ===\")\nfrom datetime import datetime\n\nclass DateEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, datetime):\n            return {'_type': 'datetime', 'value': obj.isoformat()}\n        return super().default(obj)\n\nevent = {\n    'name': 'Conference',\n    'date': datetime(2024, 6, 15, 9, 0)\n}\n\njson_str = json.dumps(event, cls=DateEncoder, indent=2)\nprint(json_str)\n\n# Example 7: Error handling\nprint(\"\\n=== Error Handling ===\")\ninvalid_json = '{name: \"missing quotes\"}'\ntry:\n    data = json.loads(invalid_json)\nexcept json.JSONDecodeError as e:\n    print(f\"JSONDecodeError: {e.msg}\")\n\n# Clean up\nfor fname in ['user.json', 'tasks.json']:\n    os.remove(fname)\nprint(\"\\nCleaned up JSON files.\")"
}
